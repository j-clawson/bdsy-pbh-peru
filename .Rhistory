'%!in%' <- function(x,y)!('%in%'(x,y))
peru <- read.csv('data\\peru.csv')
colnames(peru) <- c('region', 'province', 'district', 'year', 'week', 'department_code', 'geo_code', 'under_5_noncase', 'under_5_case', 'over_60_case', 'under_5_hospitalized', 'over_60_hospitalized', 'under_5_death', 'over_60_death')
glimpse(peru)
glimpse(peru)
summary(peru)
p3 <- ggplot(deaths_by_region, aes(x = region, y = total_deaths)) +
geom_col(fill = "skyblue") +
labs(
title = "Total Under-5 Deaths by Region",
x = "Region",
y = "Total Under-5 Deaths"
) +
theme_minimal() +
theme(axis.text.x = element_text(angle = 45, hjust = 1, size = 8))
deaths_by_region <- peru %>%
group_by(region) %>%
summarise(total_deaths = sum(under_5_death), .groups = "drop")
p3 <- ggplot(deaths_by_region, aes(x = region, y = total_deaths)) +
geom_col(fill = "skyblue") +
labs(
title = "Total Under-5 Deaths by Region",
x = "Region",
y = "Total Under-5 Deaths"
) +
theme_minimal() +
theme(axis.text.x = element_text(angle = 45, hjust = 1, size = 8))
df <- peru[c("year","week", "region", "under_5_death")]
#Group by year, week
df <- df %>%
group_by(year, week, region) %>%
summarise(
total_under_5 = sum(under_5_death, na.rm = TRUE),
.groups = "drop"
)
#Format week in standard format
df <- df %>%
mutate(date = as.Date(paste0(year, '-01-01')) + weeks(week-1))
#Aggregate into monthly counts
df <- df %>%
mutate(date = floor_date(date, "month")) %>%
group_by(date, region) %>%
summarise(
under5 = sum(total_under_5,   na.rm = TRUE),
.groups = "drop"
)
#creating a function to map deaths by region
region_to_point <- function(data, region_name) {
data <- data %>% filter(region == region_name)
p <- ggplot(data, aes(x = date, y = under5)) +
geom_line() +
geom_vline(data = vaccine_dates, aes(xintercept = date, colour = vaccine, linetype = vaccine), size = 0.8) +
scale_colour_brewer(name = "Vaccine Introduction", palette = "Dark2") +
scale_linetype_discrete(name = "Vaccine Introduction") +
labs(title = paste("Monthly <5 Deaths in", region_name), x = "Date", y = "Deaths") +
theme_minimal()
p
}
p4a <- region_to_point(df, "SAN MARTIN")
p4b <- region_to_point(df, "PUNO")
grid.arrange(p4a, p4b, nrow = 2)
df <- peru[c("year","week", "region", "under_5_death")]
#Group by year, week
df <- df %>%
group_by(year, week, region) %>%
summarise(
total_under_5 = sum(under_5_death, na.rm = TRUE),
.groups = "drop"
)
#Format week in standard format
df <- df %>%
mutate(date = as.Date(paste0(year, '-01-01')) + weeks(week-1))
#Aggregate into monthly counts
df <- df %>%
mutate(date = floor_date(date, "month")) %>%
group_by(date, region) %>%
summarise(
under5 = sum(total_under_5,   na.rm = TRUE),
.groups = "drop"
)
deaths_by_region <- peru %>%
group_by(region) %>%
summarise(total_deaths = sum(under_5_death), .groups = "drop")
p3 <- ggplot(deaths_by_region, aes(x = region, y = total_deaths)) +
geom_col(fill = "skyblue") +
labs(
title = "Total Under-5 Deaths by Region",
x = "Region",
y = "Total Under-5 Deaths"
) +
theme_minimal() +
theme(axis.text.x = element_text(angle = 45, hjust = 1, size = 8))
p3
hist(deaths_by_region$total_deaths)
hist(deaths_by_region$total_deaths)
Total_Deaths <- deaths_by_region$total_deaths
hist(Total_Deaths)
Total_Deaths <- deaths_by_region$total_deaths
hist(Total_Deaths,
main="Distribution of death counts by region",
xlab="Total Regional Death Counts",
freq=FALSE
)
Total_Deaths <- deaths_by_region$total_deaths
hist(Total_Deaths,
main="Distribution of death counts by region",
xlab="Total Regional Death Counts",
freq=FALSE
)
Total_Deaths <- deaths_by_region$total_deaths
hist(Total_Deaths,
main="Distribution of death counts by region",
xlab="Total Regional Death Counts",
col="darkmagenta",
freq=FALSE
)
head(deaths_by_region)
p4 <- ggplot(deaths_by_region, aes(x = total_deaths)) +
geom_histogram(binwidth = 50, fill = "purple", color = "white") +
facet_wrap(~ region, scales = "free_y") +
labs(title = "Death-count distributions by region", x = "Monthly <5 deaths,         y = "Count") +
p4 <- ggplot(deaths_by_region, aes(x = total_deaths)) +
geom_histogram(binwidth = 50, fill = "purple", color = "white") +
facet_wrap(~ region, scales = "free_y") +
labs(title = "Death-count distributions by region",
x = "Monthly <5 deaths", y = "Count") +
theme_minimal()
p4 <- ggplot(deaths_by_region, aes(x = total_deaths)) +
geom_histogram(binwidth = 50, fill = "purple", color = "white") +
facet_wrap(~ region, scales = "free_y") +
labs(title = "Death-count distributions by region",
x = "Monthly <5 deaths", y = "Count") +
theme_minimal()
p4
p4 <- ggplot(deaths_by_region, aes(x = total_deaths, fill = region)) +
geom_histogram(binwidth = 50, position = "identity", alpha = 0.4) +
labs(title = "Overlaid histograms by region",
x = "Monthly <5 deaths",
y = "Count") +
theme_minimal()
p4
p4 <- ggplot(deaths_by_region, aes(x = total_deaths, fill = region)) +
geom_histogram(position = "identity", alpha = 0.4) +
labs(title = "Overlaid histograms by region",
x = "Monthly <5 deaths",
y = "Count") +
theme_minimal()
p4
p4 <- ggplot(deaths_by_region, aes(x = region, y = total_deaths)) +
geom_boxplot() +
labs(title = "Boxplot of death counts by region",
x = "Region",
y = "Monthly <5 deaths") +
theme_minimal()
p4
deaths_by_region <- peru %>%
group_by(region) %>%
summarise(total_deaths = sum(under_5_death), .groups = "drop")
p3 <- ggplot(deaths_by_region, aes(x = region, y = total_deaths)) +
geom_col(fill = "skyblue") +
labs(
title = "Total Under-5 Deaths by Region",
x = "Region",
y = "Total Under-5 Deaths"
) +
theme_minimal() +
theme(axis.text.x = element_text(angle = 45, hjust = 1, size = 8))
deaths_by_region <- peru %>%
group_by(region) %>%
summarise(total_deaths = sum(under_5_death), .groups = "drop")
p3 <- ggplot(deaths_by_region, aes(x = region, y = total_deaths)) +
geom_col(fill = "skyblue") +
labs(
title = "Total Under-5 Deaths by Region",
x = "Region",
y = "Total Under-5 Deaths"
) +
theme_minimal() +
theme(axis.text.x = element_text(angle = 45, hjust = 1, size = 8))
p3
deaths_by_region <- peru %>%
group_by(region) %>%
arrange(desc(total)) %>%
summarise(total_deaths = sum(under_5_death), .groups = "drop")
deaths_by_region <- peru %>%
group_by(region) %>%
summarise(total_deaths = sum(under_5_death), .groups = "drop") %>%
arrange(desc(total_deaths))
p3 <- ggplot(deaths_by_region, aes(x = region, y = total_deaths)) +
geom_col(fill = "skyblue") +
labs(
title = "Total Under-5 Deaths by Region",
x = "Region",
y = "Total Under-5 Deaths"
) +
theme_minimal() +
theme(axis.text.x = element_text(angle = 45, hjust = 1, size = 8))
p3
head(deaths_by_region)
deaths_by_region <- peru %>%
group_by(region) %>%
summarise(total_deaths = sum(under_5_death), .groups = "drop") %>%
arrange(desc(total_deaths))
p3 <- ggplot(deaths_by_region, aes(x = region, y = total_deaths)) +
geom_col(fill = "skyblue") +
labs(
title = "Total Under-5 Deaths by Region",
x = "Region",
y = "Total Under-5 Deaths"
) +
theme_minimal() +
theme(axis.text.x = element_text(angle = 45, hjust = 1, size = 8))
p3
deaths_by_region <- peru %>%
group_by(region) %>%
summarise(total_deaths = sum(under_5_death), .groups = "drop") %>%
arrange(desc(total_deaths))
p3 <- ggplot(deaths_by_region, aes(x = fct_reorder(region, total), y = total_deaths)) +
geom_col(fill = "skyblue") +
labs(
title = "Total Under-5 Deaths by Region",
x = "Region",
y = "Total Under-5 Deaths"
) +
theme_minimal() +
theme(axis.text.x = element_text(angle = 45, hjust = 1, size = 8))
p3
deaths_by_region <- peru %>%
group_by(region) %>%
summarise(total_deaths = sum(under_5_death), .groups = "drop") %>%
arrange(desc(total_deaths))
p3 <- ggplot(deaths_by_region, aes(x = region, y = total_deaths)) +
geom_col(fill = "skyblue") +
labs(
title = "Total Under-5 Deaths by Region",
x = "Region",
y = "Total Under-5 Deaths"
) +
theme_minimal() +
theme(axis.text.x = element_text(angle = 45, hjust = 1, size = 8))
p3
deaths_by_region <- peru %>%
group_by(region) %>%
summarise(total_deaths = sum(under_5_death), .groups = "drop") %>%
arrange(desc(total_deaths))
p3 <- ggplot(deaths_by_region, aes(x = reorder(region, -total_deaths), y = total_deaths)) +
geom_col(fill = "skyblue") +
labs(
title = "Total Under-5 Deaths by Region",
x = "Region",
y = "Total Under-5 Deaths"
) +
theme_minimal() +
theme(axis.text.x = element_text(angle = 45, hjust = 1, size = 8))
p3
deaths_by_region <- peru %>%
group_by(region) %>%
summarise(total_deaths = sum(under_5_death), .groups = "drop") %>%
arrange(desc(total_deaths))
p3 <- ggplot(deaths_by_region, aes(x = reorder(region, total_deaths), y = total_deaths)) +
geom_col(fill = "skyblue") +
labs(
title = "Total Under-5 Deaths by Region",
x = "Region",
y = "Total Under-5 Deaths"
) +
theme_minimal() +
theme(axis.text.x = element_text(angle = 45, hjust = 1, size = 8))
p3
deaths_by_region <- peru %>%
group_by(region) %>%
summarise(total_deaths = sum(under_5_death), .groups = "drop")
p3 <- ggplot(deaths_by_region,
aes(x = reorder(region, total_deaths), y = total_deaths)) +
geom_col(fill = "skyblue") +
labs(
title = "Total Under-5 Deaths by Region",
x = "Region",
y = "Total Under-5 Deaths"
) +
theme_minimal() +
theme(axis.text.x = element_text(angle = 45, hjust = 1, size = 8))
p3
Total_Deaths <- deaths_by_region$total_deaths
hist(Total_Deaths,
main="Overall distribution of death counts across regions",
xlab="Total Regional Death Counts",
col="darkmagenta",
freq=FALSE
)
Total_Deaths <- deaths_by_region$total_deaths
hist(Total_Deaths,
main="Overall distribution of death counts across regions",
xlab="Total Death Counts",
col="darkmagenta",
freq=FALSE
)
Total_Deaths <- deaths_by_region$total_deaths
hist(Total_Deaths,
main="Overall distribution of death counts across regions",
xlab="Total Death Counts",
col="darkmagenta"
)
Total_Deaths <- deaths_by_region$total_deaths
hist(Total_Deaths,
main="Overall distribution of death counts across regions",
xlab="Total Death Counts",
col="darkmagenta",
freq=FALSE
)
Total_Deaths <- deaths_by_region$total_deaths
hist(Total_Deaths,
main="Overall distribution of death counts across regions",
xlab="Total Death Counts",
col="darkmagenta",
freq=FALSE
)
Total_Deaths <- deaths_by_region$total_deaths
hist(Total_Deaths,
main="Overall distribution of death counts across regions",
xlab="Total Death Counts",
col="darkmagenta",
freq=FALSE
)
Total_Deaths <- deaths_by_region$total_deaths
hist(Total_Deaths,
main="Overall distribution of death counts across regions",
xlab="Total Death Counts",
xlim = (0,1400),
Total_Deaths <- deaths_by_region$total_deaths
hist(Total_Deaths,
main="Overall distribution of death counts across regions",
xlab="Total Death Counts",
xlim = c(0,1400),
col="darkmagenta",
freq=FALSE
)
min(deaths_by_region$total_deaths)
max(deaths_by_region$total_deaths)
Total_Deaths <- deaths_by_region$total_deaths
hist(Total_Deaths, breaks=seq(18,1300, l = 6),
main="Overall distribution of death counts across regions",
xlab="Total Death Counts",
col="darkmagenta",
freq=FALSE
)
Total_Deaths <- deaths_by_region$total_deaths
hist(Total_Deaths, breaks=seq(18,1300, l = 9),
main="Overall distribution of death counts across regions",
xlab="Total Death Counts",
col="darkmagenta",
freq=FALSE
)
Total_Deaths <- deaths_by_region$total_deaths
hist(Total_Deaths, breaks=seq(18,1300, l = 8),
main="Overall distribution of death counts across regions",
xlab="Total Death Counts",
col="darkmagenta",
freq=FALSE
)
Total_Deaths <- deaths_by_region$total_deaths
hist(Total_Deaths, breaks=seq(18,1300, l = 5),
main="Overall distribution of death counts across regions",
xlab="Total Death Counts",
col="darkmagenta",
freq=FALSE
)
Total_Deaths <- deaths_by_region$total_deaths
hist(Total_Deaths, breaks=seq(18,1300, l = 6),
main="Overall distribution of death counts across regions",
xlab="Total Death Counts",
col="darkmagenta",
freq=FALSE
)
Total_Deaths <- deaths_by_region$total_deaths
hist(Total_Deaths, breaks=8,
main="Overall distribution of death counts across regions",
xlab="Total Death Counts",
col="darkmagenta",
freq=FALSE
)
Total_Deaths <- deaths_by_region$total_deaths
hist(Total_Deaths, breaks=8,
main="Overall distribution of death counts across regions",
xlab="Total Death Counts",
col="darkmagenta"
)
deaths_by_region <- peru %>%
group_by(region) %>%
summarise(total_deaths = sum(under_5_death), .groups = "drop")
p3 <- ggplot(deaths_by_region,
aes(x = reorder(region, total_deaths), y = total_deaths)) +
geom_col(fill = "skyblue") +
labs(
title = "Total <5 Deaths by Region",
x = "Region",
y = "Total <5 Deaths"
) +
theme_minimal() +
theme(axis.text.x = element_text(angle = 45, hjust = 1, size = 8))
p3
Total_Deaths <- deaths_by_region$total_deaths
deaths_hist <- hist(Total_Deaths, breaks=8,
main="Overall distribution of death counts across regions",
xlab="Total Death Counts",
col="darkmagenta")
png(
filename = "deaths_hist.png",
width    = 15,      # width in inches
height   = 9,       # height in inches
units    = "in",    # you can also use "cm" or "px"
res      = 300      # resolution in dpi
)
# draw your 2‐panel plot
grid.arrange(deaths_hist)
Total_Deaths <- deaths_by_region$total_deaths
deaths_hist <- hist(Total_Deaths, breaks=8,
main="Overall distribution of death counts across regions",
xlab="Total Death Counts",
col="darkmagenta")
png(
filename = "deaths_hist.png",
width    = 15,      # width in inches
height   = 9,       # height in inches
units    = "in",    # you can also use "cm" or "px"
res      = 300      # resolution in dpi
)
# close the device
dev.off()
Total_Deaths <- deaths_by_region$total_deaths
deaths_hist <- hist(Total_Deaths, breaks=8,
main="Overall distribution of death counts across regions",
xlab="Total Death Counts",
col="darkmagenta")
png(
filename = "deaths_hist.png",
width    = 15,      # width in inches
height   = 9,       # height in inches
units    = "in",    # you can also use "cm" or "px"
res      = 300      # resolution in dpi
)
# draw your 2‐panel plot
grid.arrange(deaths_hist)
Total_Deaths <- deaths_by_region$total_deaths
png(
filename = "deaths_hist.png",
width    = 15,      # width in inches
height   = 9,       # height in inches
units    = "in",    # you can also use "cm" or "px"
res      = 300      # resolution in dpi
)
deaths_hist <- hist(Total_Deaths, breaks=8,
main="Overall distribution of death counts across regions",
xlab="Total Death Counts",
col="darkmagenta")
# close the device
dev.off()
Total_Deaths <- deaths_by_region$total_deaths
deaths_hist <- hist(Total_Deaths, breaks=8,
main="Overall distribution of death counts across regions",
xlab="Total Death Counts",
col="darkmagenta")
png(
filename = "deaths_barplot.png",
width    = 15,      # inches
height   = 9,       # inches
units    = "in",
res      = 300      # dpi
)
p3 <- ggplot(deaths_by_region,
aes(x = reorder(region, total_deaths), y = total_deaths)) +
geom_col(fill = "skyblue") +
labs(
title = "Total <5 Deaths by Region",
x = "Region",
y = "Total <5 Deaths"
) +
theme_minimal() +
theme(axis.text.x = element_text(angle = 45, hjust = 1, size = 8))
p3
dev.off()
peru_gps <- read.csv('data\\peru_gps.csv')
head(peru_gps)
unique(peru_gps)
peru_gps[peru_gps$Clinical_manifestation == 'PNEUMONIA']
peru_gps[peru_gps$CLINICAL_MANIFESTATION == 'PNEUMONIA']
peru_gps[peru_gps$Clinical_manifestation == 'PNEUMOIA']
peru_gps[peru_gps$Clinical_manifestation == 'PNEUMONIA']
peru_gps_pneumonia <- peru_gps[
peru_gps$Clinical_manifestation == "PNEUMONIA",
]
peru_gps_pneumonia <- peru_gps[
peru_gps$Clinical_manifestation == "PNEUMONIA",
]
peru_gps_pneumonia
head(peru_gps)
peru_gps_pneumonia <- peru_gps[
peru_gps$Clinical_manifestation == "PNEUMONIA",
]
peru_gps_pneumonia[c('Age_years', 'PCV7', 'PCV13', 'PCV15', 'PCV20', 'Clinical_manifestation', 'ermB', 'mefA', 'folA_I100L', 'cat')]
peru_gps_pneumonia <- peru_gps[
peru_gps$Clinical_manifestation == "PNEUMONIA",
]
peru_gps_isolates <- peru_gps_pneumonia[c('Age_years', 'PCV7', 'PCV13', 'PCV15', 'PCV20', 'Clinical_manifestation', 'ermB', 'mefA', 'folA_I100L', 'cat')]
write.csv(df, "peru_gps_isolates.csv")
peru_gps_pneumonia <- peru_gps[
peru_gps$Clinical_manifestation == "PNEUMONIA",
]
peru_gps_isolates <- peru_gps_pneumonia[c('Age_years', 'PCV7', 'PCV13', 'PCV15', 'PCV20', 'Clinical_manifestation', 'ermB', 'mefA', 'folA_I100L', 'cat')]
write.csv(peru_gps_isolates, "peru_gps_isolates.csv")
head(peru_gps_isolates)
count(peru_gps_isolates)
